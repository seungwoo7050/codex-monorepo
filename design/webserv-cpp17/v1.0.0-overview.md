# webserv-cpp17 v1.0.0 개요

## 버전 목표
HTTP/1.1 서버를 포트폴리오에서 바로 시연할 수 있도록 v0.1.0~v0.4.0에서 완성한 기능을 문서화하고 안정화한다. 다중 연결, keep-alive, 동적 핸들러 동작을 명확히 설명한다.

## 외부 동작 요약
- 실행 시 인자로 포트와 동시 처리 최대 요청 수를 받는다. 기본 예시는 `8080 3`.
- 정적 파일을 요청 경로 기반으로 반환하며, 없을 경우 404를 응답한다.
- `/health`는 200 OK와 간단한 메시지를 반환한다.
- `/metrics`는 현재 접속 수, 처리 요청 수 등을 텍스트로 응답하는 예시 핸들러다.
- Host 헤더가 없거나 잘못된 경우 400을 반환한다.
- keep-alive가 활성화된 경우 단일 TCP 연결에서 여러 요청을 순차 처리한다.

## 내부 구조
- **소켓 초기화**: 논블로킹 서버 소켓을 열고 `SO_REUSEADDR` 설정 후 리스닝한다.
- **이벤트 루프**: `select`를 사용해 서버/클라이언트 FD를 감시하며, 활동 시간 기준으로 타임아웃을 검사한다.
- **요청 파싱**: 상태 머신으로 요청 라인→헤더→본문을 순차적으로 읽는다. Host 헤더 유무를 확인하고, Content-Length가 있으면 본문 길이까지 수신한다.
- **라우팅/응답**: 요청 경로가 정적 파일 루트 내에 존재하면 파일을 열어 200/404로 응답한다. 등록된 핸들러는 경로 매칭 후 동적 본문을 만들어 응답한다.
- **keep-alive 처리**: 응답 후 Connection 헤더와 HTTP 버전을 기반으로 연결을 유지하거나 종료한다. 유지되는 연결은 상태를 초기화해 다음 요청을 받을 준비를 한다.

## 테스트 전략
- `WebservRespondsOnce`: 단일 요청에 대한 정적 파일 응답 검증
- `WebservMultiConnections`: 다중 연결 동시 처리 및 타임아웃 정리 검증
- `WebservHostHeader`: Host 헤더 누락 시 400 응답 확인
- `WebservKeepAlive`: 동일 연결에서 두 요청을 순차 처리하는지 확인
- `WebservDynamicHandlers`: `/health`, `/metrics` 핸들러 응답 내용 검증

## 향후 개선 여지
- 파일 업로드나 CGI 실행 추가
- 설정 파일 파싱을 통한 가상호스트 지원
- TLS 지원 및 고성능 다중 이벤트 인터페이스(epoll) 전환
