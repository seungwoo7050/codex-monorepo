# philosophers-cpp17 v1.0.0 개요

## 버전 목표
- 교착/교착 회피/공정성 실험을 하나의 실행 파일로 제공해 포트폴리오용 동시성 실습 자료를 완성한다.
- 전략 구현(naive/ordered/waiter), 시뮬레이션 제어, 결과 보고 단계를 분리해 코드 가독성을 높인다.
- CLI 도움말과 설정 검증을 제공해 사용자가 손쉽게 실험 파라미터를 조정하도록 한다.

## 외부 동작과 CLI
- 실행 파일: `philosophers`
- 주요 옵션
  - `--philosophers <N>`: 철학자/포크 개수 (기본 5)
  - `--strategy naive|ordered|waiter`: 전략 선택, 기본 naive
  - `--think-ms`, `--eat-ms`: 생각/식사 시간 조정
  - `--lock-timeout-ms`: 포크 대기 타임아웃
  - `--stuck-threshold-ms`: 교착 감지 임계값
  - `--duration-ms`: 전체 실행 시간 (필수 양수)
  - `--jitter-ms`: 시작 및 슬립 지터 범위(선택)
  - `--random-seed`: RNG 시드(지터 재현용)
  - `--help`/`-h`: 옵션 요약 출력
- 출력 포맷
  - 철학자별 상태 변화(생각/식사/포크 확보 실패 등)
  - 모니터 스레드의 교착 의심 메시지
  - `[요약]` 구간: 식사 횟수, 최대 대기 시간, 분포(평균/표준편차)와 임계 대기 기준

## 내부 구조
- 구성 요소
  - `SimulationConfig`: CLI에서 받은 실행 파라미터 보관.
  - `DiningSimulation`: 스레드 생성, 모니터링, 전략별 포크 획득, 통계 수집을 총괄.
  - 전략 함수: `acquireNaive`, `acquireOrdered`, `acquireWaiter`가 포크 획득 순서를 분리 구현.
  - 동기화: `std::timed_mutex`로 포크를 모델링, `waiter` 전략은 `waiter_permits_` 토큰으로 동시 진입 제한.
  - 통계: `SimulationReport` 구조체로 식사 횟수/대기 시간/분포를 수집해 보고 단계와 분리.
- 실행 흐름
  1. `parseArguments` → `validateConfig`로 설정 파싱 및 검증.
  2. `run`에서 설정 요약 로그 출력 후 철학자 스레드와 모니터 스레드 생성.
  3. `monitorLoop`가 `stuck_threshold`를 기반으로 교착 의심을 감지하고 `runtime` 경과 시 종료 플래그 설정.
  4. 각 철학자 루프는 전략별 포크 획득 후 식사/생각을 반복하고, 대기 시간과 식사 횟수를 원자적으로 기록.
  5. 종료 후 `summarize`가 통계 집계 → `logSummary`가 사용자에게 최종 보고.
- 오류/검증
  - 음수 시간, 2명 미만 구성, 0ms 실행 시간은 `validateConfig`에서 거부 후 친절한 한국어 메시지 제공.

## 테스트 전략
- CTest 스크립트 기반(모두 Bash, set -euo pipefail)
  - `deadlock_demo.sh`: naive 전략에서 교착 의심 메시지 출력 확인.
  - `ordered_strategy.sh`: 순차 잠금 전략의 정상 진행 확인.
  - `waiter_strategy.sh`: 웨이터 토큰 전략의 정상 진행 확인.
  - `fairness_metrics.sh`: 요약 통계 출력 유효성 확인.
  - `usage_help.sh`: `--help` 호출 시 옵션 요약이 출력되는지 확인.
- 모든 테스트는 기본 CMake 빌드(`cmake -S . -B build && cmake --build build`) 후 `ctest --output-on-failure`로 실행한다.

## 향후 개선 아이디어
- 식사/대기 기록을 JSON/CSV로 내보내 그래프 도구와 연동.
- GUI나 웹 대시보드로 전략 간 차이를 시각화.
- 전략을 플러그인 형태로 분리해 새로운 실험을 쉽게 추가.
